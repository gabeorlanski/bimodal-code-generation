experiments:
  Steps:
    overrides:
      objective: 'lm'
      ++device: 0
      +disable_cache: True
    ablations:
      S:
        model: 'lvwerra/codeparrot-small'
      N:
        model: 'lvwerra/codeparrot'
    steps:
      - name: PT
        base: base
        group: SO
        overrides:
          task: so
      - name: FT
        base: finetune
        group: MBPP
        overrides:
          task: mbpp
          +is_checkpoint: True
          +model_path: best_models/${..previous_step.save_name}
    commands:
      - '{%- set pretrain_jid= "pretrain_jid"+ idx|string -%}'
      - '{{ pretrain_jid }}=$(sbatch --parsable --job-name={{ name }}_pretrain train.sbatch {{ PT.save_name }})'
      - 'echo "Submitted PreTrain (id=${{ pretrain_jid }})"'

  Simple:
    group: SO
    base: base
    overrides:
      objective: 'lm'
      ++device: 0
      +disable_cache: True
      task: so
